<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360 Business Magician - Notion Integration Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
    }
    h1 {
      color: #09557a;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    h2 {
      color: #09557a;
      margin-top: 30px;
    }
    form {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background: #09557a;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #084563;
    }
    .result {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      white-space: pre-wrap;
    }
    .card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin-top: 0;
      color: #09557a;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>360 Business Magician - Notion Integration Test</h1>
  
  <div>
    <p>This page helps you test the Notion integration for the 360 Business Magician platform. You can:</p>
    <ul>
      <li>Generate a business idea and save it to Notion</li>
      <li>Check if the Notion integration is working</li>
      <li>View the business tools and phases</li>
    </ul>
  </div>

  <h2>API Status</h2>
  <button id="checkStatus">Check API Status</button>
  <div id="statusResult" class="result"></div>

  <h2>Generate Business Idea</h2>
  <form id="ideaForm">
    <div>
      <label for="interests">Interests (comma-separated):</label>
      <input id="interests" type="text" placeholder="technology, education, accessibility" value="technology, accessibility">
    </div>
    <div>
      <label for="marketInfo">Market Information:</label>
      <input id="marketInfo" type="text" placeholder="general" value="deaf entrepreneurs">
    </div>
    <div>
      <label for="constraints">Constraints (comma-separated):</label>
      <input id="constraints" type="text" placeholder="low budget, remote work" value="remote work">
    </div>
    <button type="submit">Generate Idea</button>
  </form>
  <div id="ideaResult" class="result"></div>

  <h2>Business Tools</h2>
  <button id="getTools">Get Business Tools</button>
  <div id="toolsResult" class="result"></div>

  <h2>Business Phases</h2>
  <button id="getPhases">Get Business Phases</button>
  <div id="phasesResult" class="result"></div>

  <script>
    // Helper function to display results
    function displayResult(elementId, data, title = '') {
      const element = document.getElementById(elementId);
      
      if (title) {
        element.innerHTML = `<h3>${title}</h3>`;
      } else {
        element.innerHTML = '';
      }
      
      if (typeof data === 'object') {
        // Check if this is a business idea
        if (data.idea) {
          const idea = data.idea;
          element.innerHTML += `
            <div class="card">
              <h3>${idea.name}</h3>
              <p>${idea.description}</p>
              <p><strong>Viability Score:</strong> ${idea.viabilityScore}/100</p>
              <p><strong>Complexity:</strong> ${idea.implementationComplexity}</p>
              <p><strong>Interests:</strong> ${idea.interests.join(', ')}</p>
              <p><strong>Generated:</strong> ${new Date(idea.generatedAt).toLocaleString()}</p>
            </div>
          `;
          
          if (data.notion) {
            if (data.notion.success) {
              element.innerHTML += `<p class="success">✓ Saved to Notion! Page ID: ${data.notion.notionPageId}</p>`;
            } else {
              element.innerHTML += `<p class="error">✗ Failed to save to Notion: ${data.notion.error}</p>`;
            }
          }
        }
        // Check if these are business tools
        else if (data.tools) {
          data.tools.forEach(tool => {
            element.innerHTML += `
              <div class="card">
                <h3>${tool.name}</h3>
                <p>${tool.description}</p>
                <p><em>Tool ID: ${tool.id}</em></p>
              </div>
            `;
          });
          
          if (data.notion) {
            if (data.notion.success) {
              element.innerHTML += `<p class="success">✓ Tool list saved to Notion! Page ID: ${data.notion.notionPageId}</p>`;
            } else {
              element.innerHTML += `<p class="error">✗ Failed to save tool list to Notion: ${data.notion.error}</p>`;
            }
          }
        }
        // Check if these are business phases
        else if (data.phases) {
          data.phases.forEach(phase => {
            element.innerHTML += `
              <div class="card">
                <h3>${phase.name}</h3>
                <p>${phase.description}</p>
                <p><em>Phase ID: ${phase.id}</em></p>
              </div>
            `;
          });
          
          if (data.notion) {
            if (data.notion.success) {
              element.innerHTML += `<p class="success">✓ Phases saved to Notion! Page ID: ${data.notion.notionPageId}</p>`;
            } else {
              element.innerHTML += `<p class="error">✗ Failed to save phases to Notion: ${data.notion.error}</p>`;
            }
          }
        }
        // For API status or other objects
        else {
          element.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
      } else {
        element.textContent = data;
      }
    }

    // Check API status
    document.getElementById('checkStatus').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        
        // Also get AI status
        const aiResponse = await fetch('/api/ai-status');
        const aiData = await aiResponse.json();
        
        displayResult('statusResult', {
          apiStatus: data,
          aiStatus: aiData
        }, 'API Status');
      } catch (error) {
        displayResult('statusResult', `Error: ${error.message}`);
      }
    });

    // Generate business idea
    document.getElementById('ideaForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const interests = document.getElementById('interests').value.split(',').map(i => i.trim());
      const marketInfo = document.getElementById('marketInfo').value.trim();
      const constraints = document.getElementById('constraints').value ? 
        document.getElementById('constraints').value.split(',').map(c => c.trim()) : [];
      
      try {
        const response = await fetch('/api/generate-business-idea', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            interests,
            marketInfo,
            constraints
          })
        });
        
        const data = await response.json();
        displayResult('ideaResult', data, 'Generated Business Idea');
      } catch (error) {
        displayResult('ideaResult', `Error: ${error.message}`);
      }
    });

    // Get business tools
    document.getElementById('getTools').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/business-tools');
        const data = await response.json();
        displayResult('toolsResult', data, 'Business Tools');
      } catch (error) {
        displayResult('toolsResult', `Error: ${error.message}`);
      }
    });

    // Get business phases
    document.getElementById('getPhases').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/business-phases');
        const data = await response.json();
        displayResult('phasesResult', data, 'Business Lifecycle Phases');
      } catch (error) {
        displayResult('phasesResult', `Error: ${error.message}`);
      }
    });
  </script>
</body>
</html>